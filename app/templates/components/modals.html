<!-- User Management Modal -->
<div class="modal fade" id="userModal" tabindex="-1" aria-labelledby="userModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="userModalLabel">
                    <i class="bi bi-person-plus"></i> <span id="userModalTitle">Create New User</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="userForm">
                    <input type="hidden" id="userId" name="user_id">
                    <div class="mb-3">
                        <label for="userEmail" class="form-label">Email Address <span class="text-danger">*</span></label>
                        <input type="email" class="form-control" id="userEmail" name="email" required>
                    </div>
                    <div class="mb-3" id="passwordField">
                        <label for="userPassword" class="form-label">Password <span class="text-danger">*</span></label>
                        <input type="password" class="form-control" id="userPassword" name="password">
                        <small class="text-muted">Min 8 chars, include uppercase, lowercase, number, and special char</small>
                    </div>
                    <div class="mb-3">
                        <label for="userFullName" class="form-label">Full Name</label>
                        <input type="text" class="form-control" id="userFullName" name="full_name">
                    </div>
                    <div class="mb-3">
                        <label for="userRole" class="form-label">Role <span class="text-danger">*</span></label>
                        <select class="form-select" id="userRole" name="role" required>
                            <option value="">Select a role...</option>
                            <option value="Client">Client</option>
                            <option value="Agent">Agent</option>
                            <option value="Administrator">Administrator</option>
                        </select>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="userActive" name="is_active" checked>
                        <label class="form-check-label" for="userActive">Active Account</label>
                    </div>
                    <div id="userModalError" class="alert alert-danger d-none"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveUserBtn">
                    <i class="bi bi-save"></i> Save User
                </button>
            </div>
        </div>
    </div>
</div>

<!-- CSV Upload Modal -->
<div class="modal fade" id="csvModal" tabindex="-1" aria-labelledby="csvModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="csvModalLabel">
                    <i class="bi bi-upload"></i> Upload CSV File
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="csvUploadSection">
                    <div class="mb-4">
                        <label for="csvFile" class="form-label">Select CSV File</label>
                        <input type="file" class="form-control" id="csvFile" accept=".csv">
                        <small class="text-muted">
                            Required columns: email, full_name, bw_count, color_count
                        </small>
                    </div>
                    <div class="mb-3">
                        <a href="/samples/sample_import_minimal.csv" class="btn btn-sm btn-outline-secondary" download>
                            <i class="bi bi-download"></i> Download Sample (Minimal)
                        </a>
                        <a href="/samples/sample_import_extended.csv" class="btn btn-sm btn-outline-secondary" download>
                            <i class="bi bi-download"></i> Download Sample (Extended)
                        </a>
                    </div>
                    <div id="csvUploadError" class="alert alert-danger d-none"></div>
                </div>
                
                <div id="csvPreviewSection" class="d-none">
                    <h6 class="mb-3">Preview</h6>
                    <div id="csvPreviewContent"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="uploadCsvBtn">
                    <i class="bi bi-upload"></i> Upload File
                </button>
                <button type="button" class="btn btn-success d-none" id="validateCsvBtn">
                    <i class="bi bi-check-circle"></i> Validate & Import
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Order Details Modal -->
<div class="modal fade" id="orderModal" tabindex="-1" aria-labelledby="orderModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="orderModalLabel">
                    <i class="bi bi-file-text"></i> Order Details
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="orderModalBody">
                <div class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                {% if current_user.is_admin %}
                <div class="btn-group" id="orderActions"></div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Quota Top-up Modal -->
<div class="modal fade" id="topupModal" tabindex="-1" aria-labelledby="topupModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="topupModalLabel">
                    <i class="bi bi-plus-circle"></i> Add Quota Top-up
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="topupForm">
                    <div class="mb-3">
                        <label for="topupClient" class="form-label">Select Client <span class="text-danger">*</span></label>
                        <select class="form-select" id="topupClient" name="client_id" required>
                            <option value="">Loading clients...</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="topupBw" class="form-label">Black & White Prints</label>
                        <input type="number" class="form-control" id="topupBw" name="bw_amount" min="0" value="0">
                    </div>
                    <div class="mb-3">
                        <label for="topupColor" class="form-label">Color Prints</label>
                        <input type="number" class="form-control" id="topupColor" name="color_amount" min="0" value="0">
                    </div>
                    <div class="mb-3">
                        <label for="topupNotes" class="form-label">Notes</label>
                        <textarea class="form-control" id="topupNotes" name="notes" rows="2"></textarea>
                    </div>
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i> Minimum top-up amount is 1000 prints per type
                    </div>
                    <div id="topupError" class="alert alert-danger d-none"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveTopupBtn">
                    <i class="bi bi-save"></i> Add Top-up
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay d-none">
    <div class="loading-spinner">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3 mb-0" id="loadingText">Please wait...</p>
    </div>
</div>
